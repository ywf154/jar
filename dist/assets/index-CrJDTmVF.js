import{r as m,C as ge,J as _e,j as s,G as X,o as i,c as U,H as _,I as Z,f as n,d as l,e as t,k as ve,K as P,L as z,l as g,D as Y,p,z as V,m as x,Y as he,B as ye,v as ke}from"./index-C_8758mc.js";import{f as be,b as we,c as Te,g as Ve,u as xe,a as Ce,d as Ne}from"./task-5MMKkS2M.js";import{l as Se}from"./type-CW6g4tRd.js";const De={class:"app-container"},Ue={class:"dialog-footer"},Ye=ye({name:"Task"}),Re=Object.assign(Ye,{setup($e){const{proxy:c}=ke(),W=m([]),y=m(!1),$=m(!0),C=m(!0),F=m([]),E=m(!0),H=m(!0),I=m(0),M=m(""),k=m([]),b=m([]),K=m([{value:0,label:"待完成"},{value:1,label:"已完成"}]),j=ge({form:{},queryParams:{pageNum:1,pageSize:10,name:null,wxNoticeFrom:null,toWho:null,wxNoticeTo:null,endTime:null,status:null,finishTime:null,addTime:null,typeId:null},rules:{name:[{required:!0,message:"任务名不能为空",trigger:"blur"}],endTime:[{required:!0,message:"截止时间不能为空",trigger:"blur"}],status:[{required:!0,message:"状态不能为空",trigger:"change"}]}}),{queryParams:u,form:d,rules:ee}=_e(j),N=m([]);function le(o){const a=N.value.find(h=>h.id===o);return a?a.name:"未知类型"}function ae(){Se().then(o=>{N.value=o.rows})}ae();function Q(o){o.status==0?c.$modal.confirm("是否确认完成"+o.name).then(function(){return be(o.id)}).then(()=>{v(),c.$modal.msgSuccess("操作成功")}):c.$modal.confirm("是否确认完成"+o.name).then(function(){return we(o.id)}).then(()=>{v(),c.$modal.msgSuccess("取消成功")})}function v(){$.value=!0,u.value.params={},k!=null&&k!=""&&(u.value.params.beginFinishTime=k.value[0],u.value.params.endFinishTime=k.value[1]),b!=null&&b!=""&&(u.value.params.beginAddTime=b.value[0],u.value.params.endAddTime=b.value[1]),Te(u.value).then(o=>{W.value=o.rows,I.value=o.total,$.value=!1})}function te(){y.value=!1,R()}function R(){d.value={id:null,name:null,wxNoticeFrom:null,toWho:null,wxNoticeTo:null,endTime:null,status:null,finishTime:null,addTime:null,typeId:null},c.resetForm("taskRef")}function q(){u.value.pageNum=1,v()}function ne(){k.value=[],b.value=[],c.resetForm("queryRef"),q()}function oe(o){F.value=o.map(a=>a.id),E.value=o.length!=1,H.value=!o.length}function ue(){R(),y.value=!0,M.value="添加任务"}function G(o){R();const a=o.id||F.value;Ve(a).then(h=>{d.value=h.data,y.value=!0,M.value="修改任务"})}function de(){c.$refs.taskRef.validate(o=>{o&&(d.value.id!=null?xe(d.value).then(a=>{c.$modal.msgSuccess("修改成功"),y.value=!1,v()}):Ce(d.value).then(a=>{c.$modal.msgSuccess("新增成功"),y.value=!1,v()}))})}function J(o){const a=o.id||F.value;c.$modal.confirm('是否确认删除任务编号为"'+a+'"的数据项？').then(function(){return Ne(a)}).then(()=>{v(),c.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ie(){c.download("task/taskAll/export",{...u.value},`task_${new Date().getTime()}.xlsx`)}return v(),(o,a)=>{const h=s("el-input"),r=s("el-form-item"),S=s("el-date-picker"),A=s("el-option"),B=s("el-select"),f=s("el-button"),O=s("el-form"),D=s("el-col"),se=s("right-toolbar"),re=s("el-row"),w=s("el-table-column"),me=s("el-table"),pe=s("pagination"),ce=s("el-dialog"),T=X("hasPermi"),fe=X("loading");return i(),U("div",De,[_(l(O,{model:n(u),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(r,{label:"任务名",prop:"name"},{default:t(()=>[l(h,{modelValue:n(u).name,"onUpdate:modelValue":a[0]||(a[0]=e=>n(u).name=e),placeholder:"请输入任务名",clearable:"",onKeyup:ve(q,["enter"])},null,8,["modelValue"])]),_:1}),l(r,{label:"截止时间",prop:"endTime"},{default:t(()=>[l(S,{clearable:"",modelValue:n(u).endTime,"onUpdate:modelValue":a[1]||(a[1]=e=>n(u).endTime=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择截止时间"},null,8,["modelValue"])]),_:1}),l(r,{label:"状态",prop:"status"},{default:t(()=>[l(B,{modelValue:n(u).status,"onUpdate:modelValue":a[2]||(a[2]=e=>n(u).status=e),placeholder:"请选择状态",clearable:"",style:{width:"100px"}},{default:t(()=>[(i(!0),U(P,null,z(n(K),e=>(i(),g(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"完成时间",style:{width:"308px"}},{default:t(()=>[l(S,{modelValue:n(k),"onUpdate:modelValue":a[3]||(a[3]=e=>Y(k)?k.value=e:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(r,{label:"添加时间",style:{width:"308px"}},{default:t(()=>[l(S,{modelValue:n(b),"onUpdate:modelValue":a[4]||(a[4]=e=>Y(b)?b.value=e:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(r,{label:"任务类型",align:"center",prop:"typeId"},{default:t(()=>[l(B,{modelValue:n(u).typeId,"onUpdate:modelValue":a[5]||(a[5]=e=>n(u).typeId=e),placeholder:"请选择任务类型",clearable:"",style:{width:"200px"}},{default:t(()=>[(i(!0),U(P,null,z(n(N),e=>(i(),g(A,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(f,{type:"primary",icon:"Search",onClick:q},{default:t(()=>[p("搜索")]),_:1}),l(f,{icon:"Refresh",onClick:ne},{default:t(()=>[p("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[Z,n(C)]]),l(re,{gutter:10,class:"mb8"},{default:t(()=>[l(D,{span:1.5},{default:t(()=>[_((i(),g(f,{type:"primary",plain:"",icon:"Plus",onClick:ue},{default:t(()=>[p("新增")]),_:1})),[[T,["task:task:add"]]])]),_:1}),l(D,{span:1.5},{default:t(()=>[_((i(),g(f,{type:"success",plain:"",icon:"Edit",disabled:n(E),onClick:G},{default:t(()=>[p("修改")]),_:1},8,["disabled"])),[[T,["task:task:edit"]]])]),_:1}),l(D,{span:1.5},{default:t(()=>[_((i(),g(f,{type:"danger",plain:"",icon:"Delete",disabled:n(H),onClick:J},{default:t(()=>[p("删除")]),_:1},8,["disabled"])),[[T,["task:task:remove"]]])]),_:1}),l(D,{span:1.5},{default:t(()=>[_((i(),g(f,{type:"warning",plain:"",icon:"Download",onClick:ie},{default:t(()=>[p("导出")]),_:1})),[[T,["task:task:export"]]])]),_:1}),l(se,{showSearch:n(C),"onUpdate:showSearch":a[6]||(a[6]=e=>Y(C)?C.value=e:null),onQueryTable:v},null,8,["showSearch"])]),_:1}),_((i(),g(me,{data:n(W),onSelectionChange:oe},{default:t(()=>[l(w,{type:"selection",width:"55",align:"center"}),l(w,{label:"任务类型",align:"center",prop:"typeName",width:"100"},{default:t(e=>[p(V(le(e.row.typeId)),1)]),_:1}),l(w,{label:"任务名",align:"center",prop:"name",width:"500"}),l(w,{label:"状态",align:"center",prop:"status",width:"80"},{default:t(e=>[x("span",{style:he({color:e.row.status===1?"green":"red"})},V(n(K)[e.row.status].label),5)]),_:1}),l(w,{label:"截止时间",align:"center",prop:"endTime",width:"150"},{default:t(e=>[x("span",null,V(o.parseTime(e.row.endTime,"{y}-{m}-{d} {h}:{m}")),1)]),_:1}),l(w,{label:"完成时间",align:"center",prop:"finishTime",width:"150"},{default:t(e=>[x("span",null,V(o.parseTime(e.row.finishTime,"{y}-{m}-{d} {h}:{m}")),1)]),_:1}),l(w,{label:"添加时间",align:"center",prop:"addTime",width:"150"},{default:t(e=>[x("span",null,V(o.parseTime(e.row.addTime,"{y}-{m}-{d} {h}:{m}")),1)]),_:1}),l(w,{label:"操作",align:"center","class-name":"small-padding fixed-width",style:{width:"100px"}},{default:t(e=>[e.row.status==0?_((i(),g(f,{key:0,type:"success",icon:"check",onClick:L=>Q(e.row),style:{color:"#d4e4c3","font-weight":"bold"}},{default:t(()=>[p(" 完成任务 ")]),_:2},1032,["onClick"])),[[T,["task:task:edit"]]]):_((i(),g(f,{key:1,type:"danger",icon:"close",onClick:L=>Q(e.row),style:{color:"#ebc6c6","font-weight":"bold"}},{default:t(()=>[p(" 取消完成 ")]),_:2},1032,["onClick"])),[[T,["task:task:edit"]]]),_((i(),g(f,{link:"",type:"primary",icon:"Edit",onClick:L=>G(e.row)},{default:t(()=>[p("修改")]),_:2},1032,["onClick"])),[[T,["task:task:edit"]]]),_((i(),g(f,{link:"",type:"primary",icon:"Delete",onClick:L=>J(e.row)},{default:t(()=>[p("删除")]),_:2},1032,["onClick"])),[[T,["task:task:remove"]]])]),_:1})]),_:1},8,["data"])),[[fe,n($)]]),_(l(pe,{total:n(I),page:n(u).pageNum,"onUpdate:page":a[7]||(a[7]=e=>n(u).pageNum=e),limit:n(u).pageSize,"onUpdate:limit":a[8]||(a[8]=e=>n(u).pageSize=e),onPagination:v},null,8,["total","page","limit"]),[[Z,n(I)>0]]),l(ce,{title:n(M),modelValue:n(y),"onUpdate:modelValue":a[15]||(a[15]=e=>Y(y)?y.value=e:null),width:"500px","append-to-body":""},{footer:t(()=>[x("div",Ue,[l(f,{type:"primary",onClick:de},{default:t(()=>[p("确 定")]),_:1}),l(f,{onClick:te},{default:t(()=>[p("取 消")]),_:1})])]),default:t(()=>[l(O,{ref:"taskRef",model:n(d),rules:n(ee),"label-width":"80px"},{default:t(()=>[l(r,{label:"任务名",prop:"name"},{default:t(()=>[l(h,{modelValue:n(d).name,"onUpdate:modelValue":a[9]||(a[9]=e=>n(d).name=e),placeholder:"请输入任务名"},null,8,["modelValue"])]),_:1}),l(r,{label:"任务类型",prop:"typeId"},{default:t(()=>[l(B,{modelValue:n(d).typeId,"onUpdate:modelValue":a[10]||(a[10]=e=>n(d).typeId=e),placeholder:"请选择任务类型"},{default:t(()=>[(i(!0),U(P,null,z(n(N),e=>(i(),g(A,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"截止时间",prop:"endTime"},{default:t(()=>[l(S,{clearable:"",modelValue:n(d).endTime,"onUpdate:modelValue":a[11]||(a[11]=e=>n(d).endTime=e),type:"datetime","value-format":"YYYY-MM-DD HH:mm",placeholder:"请选择截止时间"},null,8,["modelValue"])]),_:1}),l(r,{label:"接收通知",prop:"wxNoticeFrom"},{default:t(()=>[l(h,{modelValue:n(d).wxNoticeFrom,"onUpdate:modelValue":a[12]||(a[12]=e=>n(d).wxNoticeFrom=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),l(r,{label:"交接人",prop:"toWho"},{default:t(()=>[l(h,{modelValue:n(d).toWho,"onUpdate:modelValue":a[13]||(a[13]=e=>n(d).toWho=e),placeholder:"请输入交接人"},null,8,["modelValue"])]),_:1}),l(r,{label:"发出通知",prop:"wxNoticeTo"},{default:t(()=>[l(h,{modelValue:n(d).wxNoticeTo,"onUpdate:modelValue":a[14]||(a[14]=e=>n(d).wxNoticeTo=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Re as default};
