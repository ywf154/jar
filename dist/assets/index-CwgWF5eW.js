import{r as _,C as _e,J as ge,j as s,G as j,o as r,c as F,H as g,I as z,f as a,d as t,e as o,k as K,K as Q,L as A,l as k,p,D as G,z as Y,m as R,B as ke,v as ve}from"./index-C_8758mc.js";import{f as he,l as ye,g as be,u as we,a as Ve,d as Te}from"./task-5MMKkS2M.js";import{l as xe}from"./type-CW6g4tRd.js";const Se={class:"app-container"},Ce={class:"dialog-footer"},De=ke({name:"Task"}),Fe=Object.assign(De,{setup(Ne){const{proxy:f}=ve(),W=_([]),v=_(!1),D=_(!0),V=_(!0),N=_([]),q=_(!0),B=_(!0),$=_(0),U=_(""),T=_([]);function J(n){const e=T.value.find(m=>m.id===n);return e?e.name:"未知类型"}function O(){xe().then(n=>{T.value=n.rows})}O();function X(n){f.$modal.confirm("是否确认完成"+obj.name).then(function(){return he(obj.id)}).then(()=>{h(),f.$modal.msgSuccess("操作成功")})}const Z=_e({form:{},queryParams:{pageNum:1,pageSize:10,name:null,wxNoticeFrom:null,toWho:null,wxNoticeTo:null,endTime:null,status:null,typeId:null},rules:{name:[{required:!0,message:"任务名不能为空",trigger:"blur"}],endTime:[{required:!0,message:"截止时间不能为空",trigger:"blur"}],status:[{required:!0,message:"状态不能为空",trigger:"change"}]}}),{queryParams:d,form:u,rules:ee}=ge(Z);function h(){D.value=!0,ye(d.value).then(n=>{W.value=n.rows,$.value=n.total,D.value=!1})}h();function le(){v.value=!1,I()}function I(){u.value={id:null,name:null,wxNoticeFrom:null,toWho:null,wxNoticeTo:null,endTime:te(),status:null,finishTime:null,addTime:null,typeId:null},f.resetForm("taskRef")}function te(){const n=new Date,e=new Date(n);return e.setDate(n.getDate()+1),e.setHours(17,30,0,0),ae(e)}function ae(n){const e=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),x=String(n.getHours()).padStart(2,"0"),S=String(n.getMinutes()).padStart(2,"0");return`${e}-${m}-${i} ${x}:${S}`}function w(){d.value.pageNum=1,h()}function oe(){f.resetForm("queryRef"),w()}function ne(n){N.value=n.map(e=>e.id),q.value=n.length!=1,B.value=!n.length}function ue(){I(),v.value=!0,U.value="添加任务"}function M(n){I();const e=n.id||N.value;be(e).then(m=>{u.value=m.data,v.value=!0,U.value="修改任务"})}function de(){f.$refs.taskRef.validate(n=>{n&&(u.value.id!=null?we(u.value).then(e=>{f.$modal.msgSuccess("修改成功"),v.value=!1,h()}):Ve(u.value).then(e=>{f.$modal.msgSuccess("新增成功"),v.value=!1,h()}))})}function P(n){const e=n.id||N.value;f.$modal.confirm('是否确认删除任务编号为"'+e+'"的数据项？').then(function(){return Te(e)}).then(()=>{h(),f.$modal.msgSuccess("删除成功")}).catch(()=>{})}function se(){f.download("task/task/export",{...d.value},`task_${new Date().getTime()}.xlsx`)}return(n,e)=>{const m=s("el-input"),i=s("el-form-item"),x=s("el-date-picker"),S=s("el-option"),E=s("el-select"),c=s("el-button"),H=s("el-form"),C=s("el-col"),ie=s("right-toolbar"),re=s("el-row"),b=s("el-table-column"),me=s("el-table"),pe=s("pagination"),ce=s("el-dialog"),y=j("hasPermi"),fe=j("loading");return r(),F("div",Se,[g(t(H,{model:a(d),ref:"queryRef",inline:!0,"label-width":"68px"},{default:o(()=>[t(i,{label:"任务名",prop:"name"},{default:o(()=>[t(m,{modelValue:a(d).name,"onUpdate:modelValue":e[0]||(e[0]=l=>a(d).name=l),placeholder:"请输入任务名",clearable:"",onKeyup:K(w,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"交接人",prop:"toWho"},{default:o(()=>[t(m,{modelValue:a(d).toWho,"onUpdate:modelValue":e[1]||(e[1]=l=>a(d).toWho=l),placeholder:"请输入交接人",clearable:"",onKeyup:K(w,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"截止时间",prop:"endTime"},{default:o(()=>[t(x,{clearable:"",modelValue:a(d).endTime,"onUpdate:modelValue":e[2]||(e[2]=l=>a(d).endTime=l),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择截止时间"},null,8,["modelValue"])]),_:1}),t(i,{label:"种类",prop:"typeId"},{default:o(()=>[t(E,{modelValue:a(d).typeId,"onUpdate:modelValue":e[3]||(e[3]=l=>a(d).typeId=l),placeholder:"请选择种类",clearable:"",onChange:w,style:{width:"200px"}},{default:o(()=>[(r(!0),F(Q,null,A(a(T),l=>(r(),k(S,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:o(()=>[t(c,{type:"primary",icon:"Search",onClick:w},{default:o(()=>[p("搜索")]),_:1}),t(c,{icon:"Refresh",onClick:oe},{default:o(()=>[p("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[z,a(V)]]),t(re,{gutter:10,class:"mb8"},{default:o(()=>[t(C,{span:1.5},{default:o(()=>[g((r(),k(c,{type:"primary",plain:"",icon:"Plus",onClick:ue},{default:o(()=>[p("新增")]),_:1})),[[y,["task:task:add"]]])]),_:1}),t(C,{span:1.5},{default:o(()=>[g((r(),k(c,{type:"success",plain:"",icon:"Edit",disabled:a(q),onClick:M},{default:o(()=>[p("修改")]),_:1},8,["disabled"])),[[y,["task:task:edit"]]])]),_:1}),t(C,{span:1.5},{default:o(()=>[g((r(),k(c,{type:"danger",plain:"",icon:"Delete",disabled:a(B),onClick:P},{default:o(()=>[p("删除")]),_:1},8,["disabled"])),[[y,["task:task:remove"]]])]),_:1}),t(C,{span:1.5},{default:o(()=>[g((r(),k(c,{type:"warning",plain:"",icon:"Download",onClick:se},{default:o(()=>[p("导出")]),_:1})),[[y,["task:task:export"]]])]),_:1}),t(ie,{showSearch:a(V),"onUpdate:showSearch":e[4]||(e[4]=l=>G(V)?V.value=l:null),onQueryTable:h},null,8,["showSearch"])]),_:1}),g((r(),k(me,{data:a(W),onSelectionChange:ne},{default:o(()=>[t(b,{type:"selection",width:"55",align:"center"}),t(b,{label:"任务类型",align:"center",prop:"typeName"},{default:o(l=>[p(Y(J(l.row.typeId)),1)]),_:1}),t(b,{label:"任务名",align:"center",prop:"name"}),t(b,{label:"截止时间",align:"center",prop:"endTime",width:"180"},{default:o(l=>[R("span",null,Y(n.parseTime(l.row.endTime,"{y}-{m}-{d} {h}:{m}")),1)]),_:1}),t(b,{label:"状态",align:"center",prop:"status"},{default:o(l=>[R("span",null,Y(l.row.status===0?"待完成":"已完成"),1)]),_:1}),t(b,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(l=>[g((r(),k(c,{type:"success",icon:"check",onClick:L=>X(l.row)},{default:o(()=>[p("完成任务")]),_:2},1032,["onClick"])),[[y,["task:task:edit"]]]),g((r(),k(c,{link:"",type:"primary",icon:"Edit",onClick:L=>M(l.row)},{default:o(()=>[p("修改")]),_:2},1032,["onClick"])),[[y,["task:task:edit"]]]),g((r(),k(c,{link:"",type:"primary",icon:"Delete",onClick:L=>P(l.row)},{default:o(()=>[p("删除")]),_:2},1032,["onClick"])),[[y,["task:task:remove"]]])]),_:1})]),_:1},8,["data"])),[[fe,a(D)]]),g(t(pe,{total:a($),page:a(d).pageNum,"onUpdate:page":e[5]||(e[5]=l=>a(d).pageNum=l),limit:a(d).pageSize,"onUpdate:limit":e[6]||(e[6]=l=>a(d).pageSize=l),onPagination:h},null,8,["total","page","limit"]),[[z,a($)>0]]),t(ce,{title:a(U),modelValue:a(v),"onUpdate:modelValue":e[13]||(e[13]=l=>G(v)?v.value=l:null),width:"500px","append-to-body":""},{footer:o(()=>[R("div",Ce,[t(c,{type:"primary",onClick:de},{default:o(()=>[p("确 定")]),_:1}),t(c,{onClick:le},{default:o(()=>[p("取 消")]),_:1})])]),default:o(()=>[t(H,{ref:"taskRef",model:a(u),rules:a(ee),"label-width":"80px"},{default:o(()=>[t(i,{label:"任务类型",prop:"typeId"},{default:o(()=>[t(E,{modelValue:a(u).typeId,"onUpdate:modelValue":e[7]||(e[7]=l=>a(u).typeId=l),placeholder:"请选择任务类型"},{default:o(()=>[(r(!0),F(Q,null,A(a(T),l=>(r(),k(S,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"任务名",prop:"name"},{default:o(()=>[t(m,{modelValue:a(u).name,"onUpdate:modelValue":e[8]||(e[8]=l=>a(u).name=l),placeholder:"请输入任务名"},null,8,["modelValue"])]),_:1}),t(i,{label:"截止时间",prop:"endTime"},{default:o(()=>[t(x,{clearable:"",modelValue:a(u).endTime,"onUpdate:modelValue":e[9]||(e[9]=l=>a(u).endTime=l),type:"datetime","value-format":"YYYY-MM-DD HH:mm",placeholder:"请选择截止时间"},null,8,["modelValue"])]),_:1}),t(i,{label:"接收通知",prop:"wxNoticeFrom"},{default:o(()=>[t(m,{modelValue:a(u).wxNoticeFrom,"onUpdate:modelValue":e[10]||(e[10]=l=>a(u).wxNoticeFrom=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),t(i,{label:"交接人",prop:"toWho"},{default:o(()=>[t(m,{modelValue:a(u).toWho,"onUpdate:modelValue":e[11]||(e[11]=l=>a(u).toWho=l),placeholder:"请输入交接人"},null,8,["modelValue"])]),_:1}),t(i,{label:"发出通知",prop:"wxNoticeTo"},{default:o(()=>[t(m,{modelValue:a(u).wxNoticeTo,"onUpdate:modelValue":e[12]||(e[12]=l=>a(u).wxNoticeTo=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Fe as default};
